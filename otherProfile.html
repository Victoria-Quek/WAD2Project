<!DOCTYPE html>
<html>
<head>
  <title>Profile</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="security.js"></script>
  <script src="logout.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous" />
  <!-- Icon -->
  <script src="https://kit.fontawesome.com/772b8d0d96.js" crossorigin="anonymous"></script>

  <!-- Using Vue CDN -->
  <script src="https://unpkg.com/vue@next"></script>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="gareth's_style.css"/>
  <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>
  <script type="module" src="gareth's_script.js"></script>
  </head>

  <style>
   
    
    /* Body / Profile */
    img{
      width: 250px;
    }
    @media all and (max-width: 1200px){
      img{
        width:200px;
      }
    }
    @media all and (max-width: 992px) {
      img{
        width: 180px
      }
    }
    @media all and (max-width: 767px){
      img{
        width:300px
      }
    }
    body{
      background-image: url("https://www.photojaanic.com/blog/wp-content/uploads/sites/2/2017/11/travel-photography-tips-photojaanic-7.jpg");
    }

    .submit-button {
      background: #4cafad;
      box-shadow: none;
      border: none
    }

    .submit-button:hover {
      background: #4cafad;
    }

    .submit-button:focus {
      background: #4cafad;
      box-shadow: none
    }

    .submit-button:active {
      background: #3650b7;
      box-shadow: none
    }

    .back:hover {
      color: #4cafad;
      cursor: pointer
    }

    .labels {
      font-size: 15px
    }

    p{
      font-size: 20px;
      font-weight: bold;
    }

    .add-experience:hover {
      background: #4cafad;
      color: white;
      cursor: pointer;
      border: solid 1px #4cafad;
    }
    
    /* Back button */
    #back {
        text-decoration: none;
        color: #fff;
        text-transform: uppercase;
        padding: 5px;
        padding-left: 20px;
        padding-right: 20px;
        margin-top: 5px;
        cursor: pointer;
        background-color: #4cafad;
        font-size: 16px;
        font-weight: normal;
        font-family: "Barlow Condensed";
   
    }
    .tag_checkbox { 
            margin-right: 10px; 
            max-width: 10px; 
        } 
 
        h2.card-title:hover, 
        div.card_username:hover { 
            cursor: pointer; 
            color: #4cafad; 
        } 
        .tag_badge:hover { 
            cursor: pointer; 
        }

    
  </style>

  <body>
    <!-- NAVBAR --> 
    <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light"> 
        <div class="container-fluid"> 
            <!-- APP name --> 
            <a class="navbar-brand logo" href="wad2_index.html">üåç EcoWanderers</a> 
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
                data-bs-target="#navbarSupportedContent"> 
                <span class="navbar-toggler-icon"></span> 
            </button> 
 
            <div class="collapse navbar-collapse" id="navbarSupportedContent"> 
                
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0" id="links"> 
 
                    <!-- li -->
                    <li class="nav-item"> 
                        <a class="nav-link" href="wad2_index.html">Home</a> 
                    </li> 
                    <li class="nav-item"> 
                        <a class="nav-link" href="itinerary_page.html">Posts</a>
                    </li> 
                    <li class="nav-item"> 
                        <a class="nav-link" href="Chatbot.html">Chatbot</a> 
                    </li>

                    <li class="nav-item"> 
                        <a class="nav-link" href="travelplanner1.html">Calculator</a> 
                    </li> 
                    <li class="nav-item"> 
                        <a class="nav-link" href="newProfile.html">Profile</a> 
                    </li> 
                    <li class="nav-item"> 
                        <a class="nav-link" href="#" onclick="logOut()">Logout</a> 
                    </li> 
                </ul> 
 
                
            </div> 
        </div> 
    </nav>
    <br><br><br><br><br>
    <div class="container rounded bg-white mt-5 mb-5">  
      <button type="button" class="btn" id="back" onclick="goBack()"><i class='fas fa-arrow-left'></i></button>  
      <div class="row" id="profile">
          <div class="col-md-3 border-right">
              <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                  <img :src="profilepic" alt="Profile Picture">
                  <span class="font-weight-bold">{{username}}</span>

              
              <span class="text-black-50">{{email}}</span>
              </div>
          </div>
          <div class="col-md-5 border-right" id="profile">
              <div class="p-2 py-5">
  
                  <div class="d-flex justify-content-between align-items-center mb-3">
                      <h4 class="text-right">Profile</h4>
                  </div>
                  
                  <div class="row mt-2">
                      
                      <div class="col-md-6">
                          <label class="labels">Name</label>
                          <p>{{firstname}}</p>

                      </div>
  
                      <div class="col-md-6">
                          <label class="labels">Surname</label>
                          <p>{{surname}}</p>

                      </div>
  
                  </div>
                  
                  <div class="row mt-3">
  
                      <div class="col-md-12">
                          <label class="labels">Mobile Number</label>
                          <p>{{mobilenum}}</p>

                      </div>
  
                      <div class="col-md-12">
                          <label class="labels">Email</label>
                          <p>{{email}}</p>

                      </div>
  
                  </div>
                  
                  <div class="row mt-3">
  
                      <div class="col-md-6">
                          <label class="labels">Country</label>
                          <p>{{country}}</p>

                      </div>
  
                      <div class="col-md-6">
                          <label class="labels">State/Region</label>
                          <p>{{state}}</p>

                      </div>
  
                  </div>
                  

              </div>
  
          </div>
        
          <div class="col-md-4">
              <div class="p-3 py-5">
                  <div class="d-flex justify-content-between align-items-center mb-3"><h4>Experience</h4></div>
  
                  <div class="col-md-12">
                      <label class="labels">Travelled:</label>
                      <p>{{places}}</p>

                  </div><br>
  
                  <div class="col-md-12">
                      <label class="labels">Description:</label>
                      <p>{{description}}</p>

                  </div>
  
              </div>
          </div>
      </div>
  </div>

  <!--==============Places===================--> 
  <section class="places bg-white pb-5"> 
    <div class="places-text mt-3 mt-lg-4 mt-xl-5"> 
        <h2 id="Itinerary_section">POSTS</h2> 
      
    </div> 

    <div id="post_iti" class="mb-5 mx-5"> 
        <div id="store_cards" class="cards"> 

        </div> 
    </div> 
  </section>



  <script>



    var posts = []; // holds data from firebase

    var alltags = []; // have repeated tags
    // var list_of_all_tags = []; // cleaned data

    var temp_posts = [];
    var test_username = localStorage.getItem("postUsername");


    // window.onload = getData;

    window.addEventListener('load', function () {

        getData();

        
    })

    function getData(print_all) {
        console.log("hello")
        var db = firebase.firestore();
        console.log("db: ", db);

        db.collection("all_posts").get().then((querySnapshot) => {

            querySnapshot.forEach(doc => {
                posts.push({ id: doc.id, ...doc.data() })
            });
            console.log(posts);
            temp_posts = posts.slice();
            filter_post_userOnly(posts)
        });
    }

    function filter_post_userOnly(posts){
        var filtered_posts = posts;
        filtered_posts=filtered_posts.filter(post =>
            post.username === test_username
        )

        createItineraryPosts(filtered_posts)
    }

    function createItineraryPosts(posts) {


        for (post of posts) {
            console.log(post);
            let id = post.id;
            let username = post.username;
            let title = post.title;
            let description = post.description;
            let tags = post.tags;
            let attractions = post.attractions;
            console.log("attractions: ", attractions);

            alltags.push(tags);
            // populate_tag_filter_dropdown(alltags);

            let post_iti = document.getElementById("post_iti");

            let store_cards = document.getElementById("store_cards");

            let card = document.createElement("div");
            card.setAttribute("class", "card");
            card.setAttribute("style", "width: 100%;");
            card.setAttribute("id", id);

            let card_body = document.createElement("div");
            card_body.setAttribute("class", "card-body h-100 w-100 overflow-auto");

            let card_title = document.createElement("h2");
            card_title.setAttribute("class", "card-title mx-3");
            card_title.setAttribute("style", "font-family:Roboto")
            // card_title.setAttribute("onclick", "iti_details(event)")
            card_title.innerHTML = title;
            card_title.onclick = function (event) {
                iti_details(event, posts);
            };

            let card_text = document.createElement("p");
            card_text.setAttribute("class", "card-text");

            tags.forEach((tag) => {
                let tag_span = document.createElement("span");
                tag_span.setAttribute("class", "tag_badge badge m-1");

                tag_span.setAttribute("style", "font-family: Roboto; background-color: #4cafad; colour: #14425f")
                tag_span.innerHTML = "# " + tag;

                tag_span.addEventListener('click', (function (tagCopy) {
                    return function () {
                        handleTagClick(tagCopy);
                    };
                })(tag));

                card_text.appendChild(tag_span);
            });

            let card_username = document.createElement("div");
            card_username.setAttribute("class", "card_username card-text mt-3");
            card_username.setAttribute("style", "font-family: Barlow ;");
            card_username.addEventListener('click', function () {
                // Store the username in localStorage
                localStorage.setItem("postUsername", username);
                if (sessionStorage.getItem("name") == username) {
                    window.location.href = "newProfile.html";
                } else {
                    // Navigate to the next HTML page
                    window.location.href = "otherProfile.html";
                }
            });
            card_username.innerHTML = username;

            let card_zoom = document.createElement("div");
            card_zoom.setAttribute("class", "zoom_img");


            let card_img = document.createElement("div");
            card_img.setAttribute("class", "img-card");

            let carousel_display = document.createElement("div");
            carousel_display.setAttribute("id", "carousel_display" + id);
            carousel_display.setAttribute("class", "container carousel slide  ms-auto me-auto mt-3 mb-3 border-0");
            carousel_display.setAttribute("data-bs-ride", "carousel");

            let carousel_inner = document.createElement("div");
            carousel_inner.setAttribute("class", "carousel-inner");
            // console.log("attractions: ",attractions);
            // console.log("attractions[0]: ",attractions[0]);
            // var test = attractions[0];
            // console.log("attractions[0]key: ",Object.keys(test));
            // console.log("attractions[0]key: ",test["images"]);
            for (key in attractions) {
                // console.log("attraction: ",attraction);
                let attraction = attractions[key];


                for (image of attraction.images) {
                    let carousel_item = document.createElement("div");
                    carousel_item.setAttribute("class", "carousel-item");
                    if (image == attractions[0]['images'][0]) {
                        carousel_item.setAttribute("class", "carousel-item active");
                    }
                    let carousel_img = document.createElement("img");
                    carousel_img.setAttribute("src", image);
                    carousel_img.setAttribute("class", "d-block w-100");
                    carousel_img.setAttribute("alt", "...");
                    carousel_item.appendChild(carousel_img);
                    carousel_inner.appendChild(carousel_item);
                }
            }

            let carousel_control_prev = document.createElement("button");
            carousel_control_prev.setAttribute("class", "carousel-control-prev");
            carousel_control_prev.setAttribute("type", "button");
            carousel_control_prev.setAttribute("data-bs-target", "#carousel_display" + id);
            carousel_control_prev.setAttribute("data-bs-slide", "prev");

            let carousel_control_prev_span = document.createElement("span");
            carousel_control_prev_span.setAttribute("class", "carousel-control-prev-icon");
            carousel_control_prev_span.setAttribute("aria-hidden", "true");
            carousel_control_prev.appendChild(carousel_control_prev_span);

            let carousel_control_prev_span2 = document.createElement("span");
            carousel_control_prev_span2.setAttribute("class", "visually-hidden");
            carousel_control_prev_span2.innerHTML = "Previous";
            carousel_control_prev.appendChild(carousel_control_prev_span2);

            let carousel_control_next = document.createElement("button");
            carousel_control_next.setAttribute("class", "carousel-control-next");
            carousel_control_next.setAttribute("type", "button");
            carousel_control_next.setAttribute("data-bs-target", "#carousel_display" + id);
            carousel_control_next.setAttribute("data-bs-slide", "next");

            let carousel_control_next_span = document.createElement("span");
            carousel_control_next_span.setAttribute("class", "carousel-control-next-icon");
            carousel_control_next_span.setAttribute("aria-hidden", "true");
            carousel_control_next.appendChild(carousel_control_next_span);

            let carousel_control_next_span2 = document.createElement("span");
            carousel_control_next_span2.setAttribute("class", "visually-hidden");
            carousel_control_next_span2.innerHTML = "Next";
            carousel_control_next.appendChild(carousel_control_next_span2);

            carousel_display.appendChild(carousel_inner);
            carousel_display.appendChild(carousel_control_prev);
            carousel_display.appendChild(carousel_control_next);

            card_img.appendChild(carousel_display);

            card_zoom.appendChild(card_img);




            // card_body.appendChild(card_title);
            card_body.appendChild(card_text);
            card.appendChild(card_username);
            card.appendChild(card_zoom);
            card.appendChild(card_title);
            card.appendChild(card_body);
            // post_iti.appendChild(card);
            store_cards.appendChild(card);

        }
    }
    function handleTagClick(tag) {
        // Handle tag click
        console.log(tag);
        localStorage.setItem("tag_from_Detailspage", tag);
        window.location.href = "itinerary_page.html"
    }
    function iti_details(event, posts) {
        var title_ele = event.target;
        var card_ele = title_ele.parentElement

        console.log("card_ele: ", card_ele);
        var id = card_ele.id;
        console.log("id: ", id);

        for (post of posts) {
            if (post.id == id) {
                console.log("post: ", post);
                localStorage.setItem("post", JSON.stringify(post));
            }
        }



        window.location.href = "itinerary_details.html"
    }


</script> 



  <script>
    function goBack(){
        window.location.assign("itinerary_page.html") // to EDIT
    }
  </script>
  <script type="module">


    let viewName = localStorage.getItem("postUsername")
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, push, child,update,get } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCk-z1yLhZiO77mBIpiosAzKaDKLH1jms0",
      authDomain: "wad2-e3cd8.firebaseapp.com",
      databaseURL: "https://wad2-e3cd8-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "wad2-e3cd8",
      storageBucket: "wad2-e3cd8.appspot.com",
      messagingSenderId: "812134457192",
      appId: "1:812134457192:web:eeef06726f2f7af35e40dd",
      measurementId: "G-61H6ZXLM3R"
    };
  
    // Initialize Firebase
    var viewUser = viewName
    const app = initializeApp(firebaseConfig);
    const db= getDatabase(app);
    console.log(db)
    const userProfile = ref(db, 'userProfile/' + viewUser);
    console.log(userProfile)
    var details = []

    get(userProfile).then((snapshot) => {
    
        const datal = snapshot.val()
   
      const vm1 = Vue.createApp({
          data() {
              return {
                  profilepic: "https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg",
                  username: viewUser,
                  firstname: datal.firstname,
                  surname: datal.surname,
                  mobilenum: datal.mobilenum,
                  email: datal.email,
                  country: datal.country,
                  state: datal.state,
                  places: datal.places,
                  description: datal.description,
 
              };
          },
          
      }).mount('#profile');
   
    }); 
    

  
  </script>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

</html>
